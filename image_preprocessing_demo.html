<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Preprocessing Pipeline Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .pipeline-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .step {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .step:hover {
            transform: translateY(-5px);
            border-color: #3498db;
        }
        
        .step.active {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fff, #f8f9fa);
        }
        
        .step h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-number {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .step canvas {
            width: 100%;
            max-width: 200px;
            height: 200px;
            border: 2px solid #34495e;
            border-radius: 10px;
            margin: 10px 0;
            image-rendering: pixelated;
            background: #f8f9fa;
        }
        
        .code-snippet {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .info-panel {
            background: #34495e;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 10px 0;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }
        
        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 10px 10px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .btn.animate {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            background: rgba(52, 152, 219, 0.1);
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: #2980b9;
        }
        
        .upload-area input[type="file"] {
            display: none;
        }
        
        .upload-label {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .upload-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .explanation {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
        }
        
        .explanation h3 {
            margin-top: 0;
            font-size: 1.3em;
        }
        
        .final-shape {
            background: #27ae60;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }
        
        .pixel-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            margin: 10px 0;
            background: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
        }
        
        .pixel {
            width: 20px;
            height: 20px;
            border: 1px solid #bdc3c7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Image Preprocessing Pipeline Demo</h1>
        
        <div class="explanation">
            <h3>üéØ What is this pipeline for?</h3>
            <p>This preprocessing pipeline prepares images for machine learning models, especially digit recognition (MNIST-style). Each step transforms the image to match the expected input format of neural networks.</p>
        </div>
        
        <div class="controls">
            <div class="upload-area">
                <label for="imageInput" class="upload-label">
                    üìÅ Upload Your Image
                </label>
                <input type="file" id="imageInput" accept="image/*">
                <p>Upload any image to see it processed through the pipeline!</p>
            </div>
            
            <button class="btn" onclick="generateDigitSample()">üî¢ Generate Sample Digit</button>
            <button class="btn" onclick="generateTextSample()">üìù Generate Sample Text</button>
            <button class="btn animate" onclick="animatePipeline()">‚ñ∂Ô∏è Animate Pipeline</button>
            <button class="btn" onclick="showPixelValues()">üîç Show Pixel Values</button>
        </div>
        
        <div class="pipeline-container">
            <!-- Step 1: Original -->
            <div class="step" id="step1">
                <h3><span class="step-number">1</span>Original Image</h3>
                <canvas id="originalCanvas" width="200" height="200"></canvas>
                <div class="code-snippet">
img = cv2.imread('image.png', cv2.IMREAD_GRAYSCALE)
                </div>
                <div class="info-panel" id="originalInfo">
                    Original size: Click to load image
                </div>
            </div>
            
            <!-- Step 2: Resize -->
            <div class="step" id="step2">
                <h3><span class="step-number">2</span>Resize to 28√ó28</h3>
                <canvas id="resizedCanvas" width="200" height="200"></canvas>
                <div class="code-snippet">
img = cv2.resize(img, (28, 28))
                </div>
                <div class="info-panel" id="resizeInfo">
                    Size: 28√ó28 pixels<br>
                    Interpolation: Bilinear
                </div>
            </div>
            
            <!-- Step 3: Invert -->
            <div class="step" id="step3">
                <h3><span class="step-number">3</span>Invert Colors</h3>
                <canvas id="invertedCanvas" width="200" height="200"></canvas>
                <div class="code-snippet">
img = 255 - img
                </div>
                <div class="info-panel" id="invertInfo">
                    Black ‚Üí White (0 ‚Üí 255)<br>
                    White ‚Üí Black (255 ‚Üí 0)
                </div>
            </div>
            
            <!-- Step 4: Normalize -->
            <div class="step" id="step4">
                <h3><span class="step-number">4</span>Normalize</h3>
                <canvas id="normalizedCanvas" width="200" height="200"></canvas>
                <div class="code-snippet">
img = img / 255.0
                </div>
                <div class="info-panel" id="normalizeInfo">
                    Range: 0.0 - 1.0<br>
                    Type: float32
                </div>
            </div>
            
            <!-- Step 5: Reshape -->
            <div class="step" id="step5">
                <h3><span class="step-number">5</span>Reshape for Model</h3>
                <canvas id="reshapedCanvas" width="200" height="200"></canvas>
                <div class="code-snippet">
img = img.reshape(1, 28, 28, 1)
                </div>
                <div class="info-panel" id="reshapeInfo">
                    Shape: (1, 28, 28, 1)<br>
                    Ready for ML model
                </div>
            </div>
        </div>
        
        <div class="final-shape">
            <h3>üéØ Final Array Shape</h3>
            <div style="font-size: 1.5em; margin: 15px 0;">
                (1, 28, 28, 1)
            </div>
            <div style="font-size: 1em; opacity: 0.9;">
                batch_size √ó height √ó width √ó channels
            </div>
        </div>
        
        <div class="explanation">
            <h3>ü§ñ Why These Steps?</h3>
            <p><strong>Resize:</strong> Standardizes input size for neural networks</p>
            <p><strong>Invert:</strong> Matches MNIST format (white digits on black background)</p>
            <p><strong>Normalize:</strong> Improves neural network training stability</p>
            <p><strong>Reshape:</strong> Adds batch and channel dimensions for model input</p>
        </div>
    </div>

    <script>
        const canvases = {
            original: document.getElementById('originalCanvas'),
            resized: document.getElementById('resizedCanvas'),
            inverted: document.getElementById('invertedCanvas'),
            normalized: document.getElementById('normalizedCanvas'),
            reshaped: document.getElementById('reshapedCanvas')
        };
        
        const contexts = {};
        Object.keys(canvases).forEach(key => {
            contexts[key] = canvases[key].getContext('2d');
            contexts[key].imageSmoothingEnabled = false;
        });
        
        const imageInput = document.getElementById('imageInput');
        let currentImageData = null;
        let animationStep = 0;
        
        // Generate sample digit
        function generateDigitSample() {
            const canvas = canvases.original;
            const ctx = contexts.original;
            
            // Clear canvas
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw a sample digit "7"
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 120px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('7', canvas.width/2, canvas.height/2);
            
            // Get image data and process
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            currentImageData = imageData;
            processImage(imageData);
            
            updateInfo('originalInfo', `Original size: ${canvas.width}√ó${canvas.height}`);
        }
        
        // Generate sample text
        function generateTextSample() {
            const canvas = canvases.original;
            const ctx = contexts.original;
            
            // Clear canvas
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw sample text "AI"
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 60px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('AI', canvas.width/2, canvas.height/2);
            
            // Get image data and process
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            currentImageData = imageData;
            processImage(imageData);
            
            updateInfo('originalInfo', `Original size: ${canvas.width}√ó${canvas.height}`);
        }
        
        // Handle file upload
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = canvases.original;
                        const ctx = contexts.original;
                        
                        // Clear and draw image
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        
                        // Scale image to fit canvas
                        const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                        const scaledWidth = img.width * scale;
                        const scaledHeight = img.height * scale;
                        const x = (canvas.width - scaledWidth) / 2;
                        const y = (canvas.height - scaledHeight) / 2;
                        
                        ctx.drawImage(img, x, y, scaledWidth, scaledHeight);
                        
                        // Get image data and process
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        currentImageData = imageData;
                        processImage(imageData);
                        
                        updateInfo('originalInfo', `Original size: ${img.width}√ó${img.height}<br>Scaled to: ${canvas.width}√ó${canvas.height}`);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Process image through pipeline
        function processImage(originalImageData) {
            // Step 1: Convert to grayscale (already done)
            const grayData = convertToGrayscale(originalImageData);
            
            // Step 2: Resize to 28x28
            const resizedData = resizeImageData(grayData, 28, 28);
            drawImageData(contexts.resized, resizedData, canvases.resized.width, canvases.resized.height);
            updateInfo('resizeInfo', `Size: 28√ó28 pixels<br>Interpolation: Nearest neighbor`);
            
            // Step 3: Invert colors
            const invertedData = invertImageData(resizedData);
            drawImageData(contexts.inverted, invertedData, canvases.inverted.width, canvases.inverted.height);
            updateInfo('invertInfo', `Black ‚Üí White (0 ‚Üí 255)<br>White ‚Üí Black (255 ‚Üí 0)`);
            
            // Step 4: Normalize (visual representation)
            drawImageData(contexts.normalized, invertedData, canvases.normalized.width, canvases.normalized.height);
            updateInfo('normalizeInfo', `Range: 0.0 - 1.0<br>Type: float32<br>Division by 255.0`);
            
            // Step 5: Reshape (same visual, different data structure)
            drawImageData(contexts.reshaped, invertedData, canvases.reshaped.width, canvases.reshaped.height);
            updateInfo('reshapeInfo', `Shape: (1, 28, 28, 1)<br>Batch: 1, H: 28, W: 28, C: 1`);
        }
        
        // Convert to grayscale
        function convertToGrayscale(imageData) {
            const data = new Uint8ClampedArray(imageData.data);
            for (let i = 0; i < data.length; i += 4) {
                const gray = Math.round(0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]);
                data[i] = gray;
                data[i + 1] = gray;
                data[i + 2] = gray;
            }
            return new ImageData(data, imageData.width, imageData.height);
        }
        
        // Resize image data
        function resizeImageData(imageData, newWidth, newHeight) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = imageData.width;
            canvas.height = imageData.height;
            ctx.putImageData(imageData, 0, 0);
            
            const resizedCanvas = document.createElement('canvas');
            const resizedCtx = resizedCanvas.getContext('2d');
            resizedCanvas.width = newWidth;
            resizedCanvas.height = newHeight;
            resizedCtx.imageSmoothingEnabled = false;
            resizedCtx.drawImage(canvas, 0, 0, newWidth, newHeight);
            
            return resizedCtx.getImageData(0, 0, newWidth, newHeight);
        }
        
        // Invert image data
        function invertImageData(imageData) {
            const data = new Uint8ClampedArray(imageData.data);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 255 - data[i];
                data[i + 1] = 255 - data[i + 1];
                data[i + 2] = 255 - data[i + 2];
            }
            return new ImageData(data, imageData.width, imageData.height);
        }
        
        // Draw image data scaled to canvas
        function drawImageData(ctx, imageData, canvasWidth, canvasHeight) {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = imageData.width;
            tempCanvas.height = imageData.height;
            tempCtx.putImageData(imageData, 0, 0);
            
            ctx.imageSmoothingEnabled = false;
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            ctx.drawImage(tempCanvas, 0, 0, canvasWidth, canvasHeight);
        }
        
        // Update info panel
        function updateInfo(elementId, text) {
            document.getElementById(elementId).innerHTML = text;
        }
        
        // Animate pipeline
        function animatePipeline() {
            if (!currentImageData) {
                generateDigitSample();
                return;
            }
            
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            let currentStep = 0;
            
            function highlightStep() {
                // Remove active class from all steps
                steps.forEach(step => {
                    document.getElementById(step).classList.remove('active');
                });
                
                // Add active class to current step
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                    setTimeout(highlightStep, 1000);
                }
            }
            
            highlightStep();
        }
        
        // Show pixel values
        function showPixelValues() {
            if (!currentImageData) {
                alert('Please generate a sample image or upload an image first!');
                return;
            }
            
            alert('Click on any of the processed images to see pixel values at that position!');
        }
        
        // Add click handlers for pixel values
        function addPixelClickHandlers() {
            Object.keys(canvases).forEach(key => {
                canvases[key].addEventListener('click', function(e) {
                    if (!currentImageData) return;
                    
                    const rect = this.getBoundingClientRect();
                    const x = Math.floor((e.clientX - rect.left) / rect.width * 28);
                    const y = Math.floor((e.clientY - rect.top) / rect.height * 28);
                    
                    if (x >= 0 && x < 28 && y >= 0 && y < 28) {
                        alert(`${key.charAt(0).toUpperCase() + key.slice(1)} Image\nPosition: (${x}, ${y})\nClick coordinates: (${Math.floor(e.clientX - rect.left)}, ${Math.floor(e.clientY - rect.top)})`);
                    }
                });
            });
        }
        
        // Initialize
        generateDigitSample();
        addPixelClickHandlers();
    </script>
</body>
</html>